# GitHub Project Readyカード要件定義（2026-02-19）

## 1. 目的
GitHub Project「四遊楽ツールズ project」の `Status = Ready` にあるカードを対象に、実装すべき要件を定義する。

## 2. 取得対象と取得日時
- Project: `Shimmy1219/gacha_web` の Project v2 #1（四遊楽ツールズ project）
- 取得日時: 2026-02-19 23:23:16 (JST)
- Readyカード数: 2件

### 2.1 Readyカード一覧
1. Issue `#407`
- タイトル: ログインしていない場合、クイック送信ボタンを表示しないようにする
- URL: https://github.com/Shimmy1219/gacha_web/issues/407
- 本文/コメント: なし

2. Draftカード
- タイトル: ログインしていない時は、アップロードまでしか出来ない事を明示する
- URL: なし（Draft）
- 本文: なし

## 3. 現状整理（コードベース）
- `apps/web/src/modals/dialogs/DrawGachaDialog.tsx`
  - 「お渡し部屋に景品を送信」ボタンは描画されるが、未ログイン時は `disabled` になる実装。
- `apps/web/src/modals/dialogs/SaveOptionsDialog.tsx`
  - 「Discordで共有」カードは常時表示。
  - 未ログインでも押下可能で、押下後にエラーバナーでログイン要求を表示する実装。

## 4. 要件定義

### 4.1 要件A（Issue #407）
未ログイン時に、クイック送信ボタン（お渡し部屋に景品を送信）を表示しない。

#### 機能要件
- A-1. `DrawGachaDialog` で `discordSession.loggedIn !== true` の場合、Discord送信ボタンをDOMに描画しない。
- A-2. ログイン済み (`discordSession.loggedIn === true`) かつ既存の送信可能条件を満たす場合のみ、Discord送信ボタンを表示する。
- A-3. 既存の共有機能（結果共有、X共有、コピー）はログイン状態に関係なく現状挙動を維持する。
- A-4. ログイン状態がモーダル表示中に変化した場合、再描画で表示/非表示が即時反映される。

#### 受け入れ条件
- A-AC1. 未ログイン状態でガチャ実行結果を表示しても、Discord送信ボタンが表示されない。
- A-AC2. ログイン状態で同画面を表示すると、Discord送信ボタンが表示される。
- A-AC3. ボタン非表示によりレイアウト崩れや他ボタンの操作不能が発生しない。

### 4.2 要件B（Draftカード）
未ログイン時は「アップロードまでしかできない」ことをUIで明示する。

#### 解釈（要件化の前提）
- 本カードは「Discord共有はログイン必須であり、未ログイン時に実行可能なのはZIPアップロードまで」という制約を、事前に分かる形で示すことを要求していると解釈する。

#### 機能要件
- B-1. `SaveOptionsDialog` で未ログイン時に、Discord共有不可であることを明示する説明文を表示する。
- B-2. 説明文には「未ログイン時はZIPアップロードまで可能」「Discord共有はログイン後に可能」の2点を含める。
- B-3. 未ログイン時のDiscord共有カードは実行不可状態（disabled）を維持し、押下後エラーに依存しない導線にする。
- B-4. ログイン後は説明文を非表示（またはログイン済み文言へ切替）し、既存のDiscord共有フローを利用可能にする。

#### 受け入れ条件
- B-AC1. 未ログインで `SaveOptionsDialog` を開いたとき、Discord共有不可・アップロードまで可能である旨が画面上で一目で分かる。
- B-AC2. 未ログイン時にDiscord共有カードを押下しても送信処理は開始されない。
- B-AC3. ログイン後はDiscord共有が従来通り実行できる。

## 5. 非機能要件
- 表示文言は既存トーン（日本語、短文、行動が明確）に合わせる。
- 既存アクセシビリティを維持する（`disabled` の適切な反映、視認可能な補助文）。
- 既存のエラーハンドリング（CSRF失敗・送信失敗等）の動作は変更しない。

## 6. テスト観点
1. 状態別表示テスト
- 未ログイン: Draw結果画面にDiscord送信ボタンがない。
- ログイン済み: Draw結果画面にDiscord送信ボタンがある。

2. SaveOptions画面テスト
- 未ログイン: 「アップロードまで可能」の明示文言が表示される。
- 未ログイン: Discord共有カードは実行不可。
- ログイン済み: 明示文言が消える/切り替わり、共有カードが利用可能。

3. 回帰テスト
- ZIP保存、ZIPアップロード、共有URL表示・コピー、Discord共有（ログイン済み）が既存通り動作する。

## 7. 実装範囲外
- Discord認証方式の変更
- Projectカード運用ルールの変更
- Discord共有API仕様の変更

## 8. 未確定事項
- 「アップロードまでしか出来ない」の表示文言最終案（短文/詳細文）
- 未ログイン時の明示位置（カード上部バナー or Discordカード内補助文）

